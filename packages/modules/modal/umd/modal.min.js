!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["react","react-dom"],t):e.modal=t(null,null)}(this,function(e,t){"use strict";var o="default"in e?e.default:e;t=t&&t.hasOwnProperty("default")?t.default:t;var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},s=function(e){function o(){return n(this,o),r(this,e.apply(this,arguments))}return i(o,e),o.prototype.componentDidMount=function(){this.props.open&&this.renderPortal()},o.prototype.componentDidUpdate=function(e,t){this.renderPortal(),e.open&&!this.props.open&&this.unmountPortal()},o.prototype.componentWillUnmount=function(){this.unmountPortal()},o.prototype.renderPortal=function(){this.props.open&&(this.mountPortal(),this.portal=t.unstable_renderSubtreeIntoContainer(this,this.props.children,this.rootNode))},o.prototype.mountPortal=function(){if(!this.rootNode){var e=document.body;this.rootNode=document.createElement("div"),this.rootNode.className="",e.appendChild(this.rootNode)}},o.prototype.unmountPortal=function(){if(!this.rootNode)return!1;t.unmountComponentAtNode(this.rootNode),this.rootNode.parentNode.removeChild(this.rootNode),this.rootNode=null,this.portal=null},o.prototype.render=function(){return null},o}(e.Component),a=function(e){function t(o){n(this,t);var i=r(this,e.call(this,o));return i.state={cursor:"pointer",clientx:null,clienty:null,isDragging:!1},i.handleMouseDown=i.handleMouseDown.bind(i),i.move=i.move.bind(i),i.up=i.up.bind(i),i.keydown=i.keydown.bind(i),i.resize=i.resize.bind(i),document.addEventListener("mousemove",i.move,!1),document.addEventListener("mouseup",i.up,!1),document.addEventListener("keydown",i.keydown,!1),window.addEventListener("resize",i.resize,!1),i.innerWidth=window.innerWidth,i.innerHeight=window.innerHeight,i}return i(t,e),t.prototype.shouldComponentUpdate=function(e,t){return(e.initLeft!==this.props.initLeft||e.initTop!==this.props.initTop)&&(console.log("%c update Component","color: green"),!0)},t.prototype.componentWillUnmount=function(){document.removeEventListener("mousemove",this.move,!1),document.removeEventListener("mouseup",this.up,!1),document.removeEventListener("keydown",this.keydown,!1),window.removeEventListener("resize",this.resize,!1)},t.prototype.move=function(e){var t=this.state,o=t.isDragging,n=t.clientx,i=t.clienty,r=this.props,s=r.initLeft,a=r.initTop,l=r.height,p=r.width,c=function(e){return e>0?e:0};if(o&&void 0!==s){var d=this.innerWidth,u=this.innerHeight,h=c(e.pageX-n+s),f=c(e.pageY-i+a);h=h+p>d?c(d-p):h,f=f+l>u?c(u-l):f,this.props.updatePostions(h,f)}return!1},t.prototype.up=function(e){this.setState({isDragging:!1,clientx:0,clienty:0}),this.props.updateInitPos()},t.prototype.resize=function(){this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight,console.log("%c The window resize:","color: green","width:"+this.innerWidth+" height:"+this.innerHeight)},t.prototype.keydown=function(e){!this.props.closeEsc||"Escape"!==e.key&&27!==e.which||(console.log("%c close modal","color: blue"),this.props.close())},t.prototype.handleMouseDown=function(e){return e.stopPropagation(),e.preventDefault(),console.log("%c header first click:","color: green","pageX: "+e.pageX+", pageY: "+e.pageY),this.setState({clientx:e.pageX,clienty:e.pageY,isDragging:!0}),!1},t.prototype.render=function(){var e=this.props,t=e.close,n=e.loading,i=e.title;return e.showHeader?o.createElement("div",{className:"ddi-modal-header",onMouseDown:this.handleMouseDown},n?o.createElement("span",{className:"loading"}):null,o.createElement("span",{className:"title"},i),o.createElement("i",{className:"close",onClick:t})):null},t}(e.Component);a.defaultProps={title:"",loading:!1};var l=function(e){function t(o){n(this,t);var i=r(this,e.call(this,o));return i.updatePostions=function(e,t){i.setState({left:e,top:t})},i.updateInitPos=function(){var e=i.state,t=e.left,o=e.top,n=e.initLeft,r=e.initTop;if(t===n&&o===r)return!1;console.log("%c init left, top value change:","color: green","left="+t+", top:"+o),console.log(i),i.setState({initLeft:t,initTop:o})},i.state={left:500,top:40,initLeft:500,initTop:40},i}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.open,n=e.close,i=e.size,r=i.width,l=i.height,d=this.props,u=d.showMask,h=d.drapHeader,f=d.showHeader,m=d.closeEsc,g=this.state,w=g.left,v=g.top,y=g.initLeft,E=g.initTop;return console.log("Modal render"),o.createElement(s,{open:t},o.createElement("div",null,o.createElement(p,{showMask:u}),o.createElement(c,{left:w,top:v,width:r,height:l,close:n},o.createElement(a,{updatePostions:this.updatePostions,updateInitPos:this.updateInitPos,close:n,initLeft:y,initTop:E,width:r,height:l,showHeader:f,drapHeader:h,closeEsc:m}),this.props.children)))},t}(e.Component);l.defaultProps={closeDocClick:!0,closeEsc:!0,drapHeader:!0,showHeader:!0,showMask:!0,size:{width:520,height:450}};var p=function(e){var t=e.showMask?"ddi-modal-mask":"";return o.createElement("div",{className:t})},c=function(e){var t=e.left,n=e.top,i=e.width,r=e.height,s=e.close,a=e.isClickWrap,l=void 0===a||a;return o.createElement("div",{className:"ddi-modal-wrap",onClick:function(e){e.stopPropagation();var t=e.target.className;if(console.log("%c trigger click","color:green ","Click element: "+e.target.className),"ddi-modal-wrap"!==t)return!1;l&&s()}},o.createElement("div",{className:"ddi-modal-content",style:{left:t+"px",top:n+"px",width:i+"px",height:r+"px"}},e.children))};return l});
